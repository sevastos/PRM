'use strict';

var __ = require('lodash');

var Camera = require('./camera');
var proc = require('./lib/proc');

/**
 * Low level interface to gphoto2
 * @type {Object}
 */
var gphoto = {

  getCameras: function(next) {
    proc.gmd('--auto-detect', function(res){
      var cameras = [];
      var camerasRaw = __.compact(res.split('\n').slice(2));
      for (var i = 0; i < camerasRaw.length; i++) {
        var camRaw = camerasRaw[i].trim(' ');
        var cameraData = camRaw.replace(/ {2,}/, '\t').split('\t');
        cameras.push(new Camera(cameraData[0], cameraData[1]));
      }

      next(cameras);
    });    
  },

  capture: function(){
    return proc.gpipe('--capture-image-and-download --stdout');
  }


};



module.exports = gphoto;
